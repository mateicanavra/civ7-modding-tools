**Title**  
V0.1 Slice: Config overrides (schema-driven) from UI → Worker

**Status**  
Completed

**Context**  
We currently run the `browser-test` recipe (Foundation-only) end-to-end inside a Web Worker and stream Viz layers directly to deck.gl. The worker uses a hard-coded base config (`BROWSER_TEST_RECIPE_CONFIG`), and the UI cannot change recipe config values at runtime.

We want to de-risk “config overrides” as a first-class, user-facing workflow, without changing the core V0.1 execution model (pure in-browser, no server round-trips, no dump required for visualization).

**Goal**  
Let MapGen Studio provide *optional* config overrides at runtime, merged onto the canonical base config (`BROWSER_TEST_RECIPE_CONFIG`), and used for both `compile` and `run` in the worker.

Primary UX should be a schema-driven editor (auto-generated from the recipe’s JSON schema). A raw JSON textarea remains available as an advanced/fallback path.

**Non-goals**  
- Runtime “drop-in” recipe loading without rebuild (serialized/interpreted recipe IR).  
- Making the full `standard` recipe runnable in the browser (requires additional BrowserAdapter coverage).  
- Editing non-config env inputs (beyond existing seed/map size).

**Deliverables**  
- Protocol: `run.start` includes `configOverrides?: unknown` (or a typed equivalent) rather than a placeholder empty config.
- Worker: deterministic deep-merge of base config with overrides; merged config is used for both `compile` and `run`.
- Validation: invalid overrides are rejected with a readable, structured error message surfaced in the UI.
- UI: schema-driven form to edit overrides, plus optional JSON textarea view.
- Guardrails: overrides path stays fully in-browser; no new Node-only imports enter the worker bundle.

**Acceptance criteria**  
- “Run (Browser)” with no overrides behaves exactly as today.
- When an override is applied, worker execution reflects it (plan fingerprint changes where expected; resulting layers change deterministically).
- Invalid overrides fail fast with an actionable message (e.g., “Unknown key /config/foundation/foo”, or schema validation message).
- Rerun UX retains selected step + layer (existing behavior) while applying new overrides.

**Implementation notes / checklist**  
- Export a JSON schema for `browser-test` recipe config that is consumable by the UI (TypeBox schema → JSON Schema).
  - Prefer exporting from the recipe module to keep schema aligned with the recipe.
  - Provide a runtime assertion/narrowing in Studio so schema stays typed at the boundary.
- Schema-driven editor:
  - Pick a JSON-schema React form library that works with our Vite + React setup.
  - Provide minimal UI schema (ordering, titles) if needed; keep it small and local.
  - Keep an “Advanced: JSON overrides” textarea for copy/paste and debugging.
- Deterministic merge:
  - Deep-merge semantics: objects merge recursively; arrays and scalars replace.
  - No prototype pollution: treat only plain objects as mergeable; reject `__proto__`/`constructor`/`prototype` keys.
- Worker validation:
  - Let MapGen’s existing config compilation/normalization be the primary validator (it already reports structured paths).
  - Improve error formatting when we detect a `RecipeCompileError` (include `.errors[]` detail).

**Risks / unknowns**  
- Schema form library peer deps vs React version.
- `foundation` stage schema surface may be too “wide” (if it includes internal step keys); may need a small UI schema or a “public overrides” schema.

**Follow-up**  
- Consider exporting “public override surface” separately (if we want to hide internal step IDs from the UI).
- Explore TypeBox/TypeMap-based “remote types”/schema shipping as part of future runtime-loadable recipe work.
