**Title**  
V0.1 Slice: Run Foundation in Web Worker + stream 1–2 layers directly to deck.gl (no dump required)

**Context**  
Overall source-of-truth: in-browser pipeline spec + Worker execution model. This slice exists to de-risk bundling, embedded Civ tables, adapter surface, and Worker→UI streaming by building the thinnest end-to-end path.

**Goal**  
From MapGen Studio, click “Run (Browser)” → a Web Worker runs the Foundation recipe end-to-end using bundled Civ tables + browser-safe adapter → streams 1–2 visualization layers in-memory → deck.gl renders them immediately. No “generate dump → load dump” is required for visualization.

**Non-goals (explicitly out of scope for this slice)**  
- Full Standard recipe execution in browser  
- Perfect 1:1 Civ7 engine passes (area rebuild, terrain fixups, etc.)  
- Full export/download UX (optional debug-only OK)  
- Polished UI/UX beyond minimal “Run/Cancel + render output”

**Deliverables**  
- Worker runner entry that can execute Foundation deterministically (seeded) in-browser.  
- Bundled Civ tables pipeline (scripted extraction → TS/JSON module importable by the worker) covering only what Foundation requires (terrain/biome/feature indices + any constants needed for init).  
- Minimal `VizSink` streaming protocol (Worker → main thread) that supports 1–2 layer payload types (e.g., raster grid(s) or cell attributes) and progress events.  
- MapGen Studio integration that starts/cancels the worker run, receives streamed layer payloads, and renders them via deck.gl.

**Acceptance criteria**  
- Runs entirely in the browser (Web Worker), no network calls required.  
- Worker bundle does not import Civ7 engine modules or Node-only APIs.  
- Deterministic: same seed + config produces identical streamed layer payloads across runs (within the browser).  
- At least 1–2 layers render in deck.gl from in-memory streamed payloads (not from a dump/manifest loader).  
- If “Export dump” exists in this slice, it’s optional and not required for rendering.

**Implementation notes / tasks (suggested breakdown)**  
- Define `BrowserRunRequest`/`BrowserRunEvent` protocol: `run.start`, `run.progress`, `layer.upsert` (or similar), `run.done`, `run.error`, `run.cancelled`.  
- Worker: implement `runFoundationInWorker(request)` that constructs `ctx` with a browser-safe adapter + bundled Civ tables; emits progress + 1–2 layers through the protocol; supports cancellation.  
- Data: add a script (bun) that extracts the minimal terrain/biome/feature tables from `.civ7/outputs/resources` into a browser-importable module; wire it into existing “resources refresh” workflow.  
- Studio: add a “Browser Runner” control + worker lifecycle management; implement a deck.gl layer factory that converts streamed payloads into deck.gl layers (start with the simplest representation that proves the path).  
- Guardrails: add a bundling check (or at least a smoke build) that fails if disallowed imports enter the worker graph.

**Risks / unknowns this slice should flush out**  
- Vite/Worker bundling across monorepo packages + avoiding accidental engine/Node transitive imports.  
- The exact minimal Civ table set needed to get Foundation running without hacks.  
- Payload shape and performance of streaming in-memory layer data (transferables) for real map sizes.

**Follow-up (post-slice)**  
- Update the overall spec docs based on what breaks/what we learn; slice does not replace the spec.

If you want, I can rewrite this into your preferred Linear issue format (short description + detailed acceptance + checklist) and name the first follow-on slice(s) (e.g., “add engine-approx area rebuild stub”, “expand layer types”, “Standard recipe minimal stage 1”).
