# s20 â€” Phase B: Landmask grounded in Foundation truth (numeric gate)

This slice hard-cuts the Morphology landmask to be derived from Foundation truth, eliminating noise/threshold-first landmasks.

## Behavior Change (the point)
- Landmask is now derived from a **low-frequency continent potential** computed from:
  - Foundation crust truth (`crustType`, `crustBaseElevation`, `crustAge`)
  - Foundation provenance stability (`originEra`, `driftDistance`)
- Hypsometry still sets *how much* land (via sea level), but **continent shape/connectivity** comes from Foundation truth.
- Removed `basinSeparation` (a plate-band carving surface) to avoid hidden non-physics reclassification.

## Code
- `mods/mod-swooper-maps/src/domain/morphology/ops/compute-landmask/contract.ts`
- `mods/mod-swooper-maps/src/domain/morphology/ops/compute-landmask/strategies/default.ts`
- `mods/mod-swooper-maps/src/recipes/standard/stages/morphology-coasts/steps/landmassPlates.ts`
- Config/schema updates:
  - `mods/mod-swooper-maps/src/presets/standard/earthlike.json`
  - `mods/mod-swooper-maps/src/maps/configs/*.config.*`

## Gates / Tests
```bash
bun run --cwd mods/mod-swooper-maps check
bun run --cwd mods/mod-swooper-maps test
bun run --cwd mods/mod-swooper-maps test test/pipeline/no-shadow-paths.test.ts
bun run --cwd mods/mod-swooper-maps test test/pipeline/foundation-gates.test.ts
bun run --cwd mods/mod-swooper-maps test test/pipeline/determinism-suite.test.ts
```

## Phase B Evidence (baseline vs after)

### Baseline dump
```bash
bun run --cwd mods/mod-swooper-maps diag:dump -- 106 66 1337 --label phase-b-baseline
```
```json
{"runId":"f38bd16daa5fd570b1bde65c8fb71aff831aa5f5f6472050daa32225807fe966","outputDir":"/Users/mateicanavra/Documents/.nosync/DEV/worktrees/wt-agent-GOBI-PRR-milestone-no-legacy-foundation-morphology/mods/mod-swooper-maps/dist/visualization/phase-b-baseline/f38bd16daa5fd570b1bde65c8fb71aff831aa5f5f6472050daa32225807fe966"}
```

### After dump
```bash
bun run --cwd mods/mod-swooper-maps diag:dump -- 106 66 1337 --label phase-b-after
```
```json
{"runId":"65efcd0dd9265a2c0b07561720946a8e9d1fa49e493512a9f7b82b36229036ac","outputDir":"/Users/mateicanavra/Documents/.nosync/DEV/worktrees/wt-agent-GOBI-PRR-milestone-no-legacy-foundation-morphology/mods/mod-swooper-maps/dist/visualization/phase-b-after/65efcd0dd9265a2c0b07561720946a8e9d1fa49e493512a9f7b82b36229036ac"}
```

### Compare analyze
```bash
bun run --cwd mods/mod-swooper-maps diag:analyze -- <baselineOutputDir> <afterOutputDir>
```
Key metrics from compare:

**Landmask (landmass-plates step)**
- Baseline: `pctLand=0.3571`, `landComponents=433`, `largestLandFrac=0.2598`
- After: `pctLand=0.3571`, `landComponents=4`, `largestLandFrac=0.5797`

**Landmask (geomorphology step)**
- Baseline: `pctLand=0.2296`, `landComponents=186`, `largestLandFrac=0.3562`
- After: `pctLand=0.3425`, `landComponents=4`, `largestLandFrac=0.5826`

Interpretation:
- Connectivity is now continent-scale (components collapse from hundreds to single digits).
- Largest land component share increases materially.
- Land fraction remains within sane bounds and still respects sea-level target.

### Spot-check layers
After run:
```bash
bun run --cwd mods/mod-swooper-maps diag:list -- <afterOutputDir> --dataTypeKey foundation.crustTiles.type
bun run --cwd mods/mod-swooper-maps diag:list -- <afterOutputDir> --dataTypeKey morphology.topography.landMask
```
Selected excerpts:
- `foundation.crustTiles.type` stats: `min=0`, `max=1`
- `morphology.topography.landMask` present at:
  - `...morphology-coasts.landmass-plates...`
  - `...morphology-erosion.geomorphology...`
