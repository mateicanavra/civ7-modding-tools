# s21 â€” Phase B erosion: no hidden land/water reclassification

This slice constrains geomorphology so erosion sculpts elevation without silently fragmenting continents by re-thresholding land/water.

## Change
- Geomorphology no longer recomputes `landMask` from `elevation > seaLevel`.
- Instead, it preserves the pre-erosion landmask (from `landmass-plates`) and clamps elevation/bathymetry to remain consistent with that classification.

Anchor:
- `mods/mod-swooper-maps/src/recipes/standard/stages/morphology-erosion/steps/geomorphology.ts`

## Gates / Tests
```bash
bun run --cwd mods/mod-swooper-maps check
bun run --cwd mods/mod-swooper-maps test
bun run --cwd mods/mod-swooper-maps test test/pipeline/no-shadow-paths.test.ts
bun run --cwd mods/mod-swooper-maps test test/pipeline/determinism-suite.test.ts
```

## Phase B Evidence (baseline vs s21 after)

### Baseline dump (pre-s20 code)
```bash
bun run --cwd mods/mod-swooper-maps diag:dump -- 106 66 1337 --label phase-b-baseline-pre-s20
```
```json
{"runId":"f38bd16daa5fd570b1bde65c8fb71aff831aa5f5f6472050daa32225807fe966","outputDir":"/Users/mateicanavra/Documents/.nosync/DEV/worktrees/wt-agent-GOBI-PRR-milestone-no-legacy-foundation-morphology/mods/mod-swooper-maps/dist/visualization/phase-b-baseline-pre-s20/f38bd16daa5fd570b1bde65c8fb71aff831aa5f5f6472050daa32225807fe966"}
```

### After dump (s21)
```bash
bun run --cwd mods/mod-swooper-maps diag:dump -- 106 66 1337 --label phase-b-s21-after
```
```json
{"runId":"65efcd0dd9265a2c0b07561720946a8e9d1fa49e493512a9f7b82b36229036ac","outputDir":"/Users/mateicanavra/Documents/.nosync/DEV/worktrees/wt-agent-GOBI-PRR-milestone-no-legacy-foundation-morphology/mods/mod-swooper-maps/dist/visualization/phase-b-s21-after/65efcd0dd9265a2c0b07561720946a8e9d1fa49e493512a9f7b82b36229036ac"}
```

### Compare analyze
```bash
bun run --cwd mods/mod-swooper-maps diag:analyze -- <baselineOutputDir> <afterOutputDir>
```
Key metrics from compare:

**Landmask (landmass-plates step)**
- Baseline: `pctLand=0.3571`, `landComponents=433`, `largestLandFrac=0.2598`
- After: `pctLand=0.3571`, `landComponents=4`, `largestLandFrac=0.5797`

**Landmask (geomorphology step)**
- Baseline: `pctLand=0.2296`, `landComponents=186`, `largestLandFrac=0.3562`
- After: `pctLand=0.3571`, `landComponents=4`, `largestLandFrac=0.5797`

Interpretation:
- Erosion no longer reclassifies land/water (geomorphology landmask matches landmass-plates landmask).
- Connectivity is preserved (no post-erosion re-shattering).
