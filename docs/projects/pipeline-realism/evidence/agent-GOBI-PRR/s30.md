# s30 â€” Phase C belts as modifiers (positive-intensity diffusion seeding)

This slice enforces that belt diffusion is seeded only from **positive-intensity** boundary sources, so zero-intensity belt corridor tiles cannot become the nearest diffusion seed and silently suppress influence.

## Change
- `beltDistance` / `beltNearestSeed` distance field now seeds from `beltSeedMask = beltMask && intensityBlend>0`, not from `beltMask` directly.
- Adds a regression test that constructs a belt corridor with zero-intensity corridor tiles and asserts diffusion influence is still present.

Anchor:
- `mods/mod-swooper-maps/src/domain/morphology/ops/compute-belt-drivers/deriveFromHistory.ts`

Test:
- `mods/mod-swooper-maps/test/morphology/belt-synthesis-history-provenance.test.ts`

PR:
- https://app.graphite.com/github/pr/mateicanavra/civ7-modding-tools/1155

## Gates / Tests
```bash
bun run --cwd mods/mod-swooper-maps check
bun run --cwd mods/mod-swooper-maps test
bun run --cwd mods/mod-swooper-maps test test/pipeline/no-shadow-paths.test.ts
bun run --cwd mods/mod-swooper-maps test test/pipeline/determinism-suite.test.ts
```

Determinism excerpt:
```text
[diagnostic:baseline-balanced] foundation-plate-motion-diagnostics: Plate motion diagnostics below preferred quality/residual thresholds.
[diagnostic:wrap-active] foundation-plate-motion-diagnostics: Plate motion diagnostics below preferred quality/residual thresholds.
[diagnostic:compact-low-plates] foundation-plate-motion-diagnostics: Plate motion diagnostics below preferred quality/residual thresholds.
(pass) pipeline determinism suite (M1) > produces identical fingerprints across canonical cases
```

## Evidence

### Dump
```bash
bun run --cwd mods/mod-swooper-maps diag:dump -- 106 66 1337 --label s30-phase-c-belts-seeds
```
```json
{"runId":"65efcd0dd9265a2c0b07561720946a8e9d1fa49e493512a9f7b82b36229036ac","outputDir":"/Users/mateicanavra/Documents/.nosync/DEV/worktrees/wt-agent-GOBI-PRR-milestone-no-legacy-foundation-morphology/mods/mod-swooper-maps/dist/visualization/s30-phase-c-belts-seeds/65efcd0dd9265a2c0b07561720946a8e9d1fa49e493512a9f7b82b36229036ac"}
```

### Analyze
```bash
bun run --cwd mods/mod-swooper-maps diag:analyze -- <outputDir>
```
```json
{
  "runA": {
    "runId": "65efcd0dd9265a2c0b07561720946a8e9d1fa49e493512a9f7b82b36229036ac",
    "dir": "/Users/mateicanavra/Documents/.nosync/DEV/worktrees/wt-agent-GOBI-PRR-milestone-no-legacy-foundation-morphology/mods/mod-swooper-maps/dist/visualization/s30-phase-c-belts-seeds/65efcd0dd9265a2c0b07561720946a8e9d1fa49e493512a9f7b82b36229036ac",
    "landmasks": [
      {
        "stepId": "mod-swooper-maps.standard.morphology-coasts.landmass-plates",
        "stepIndex": 10,
        "dataTypeKey": "morphology.topography.landMask",
        "pctLand": 0.3570611778158948,
        "landComponents": 4,
        "largestLandFrac": 0.5796637309847879
      },
      {
        "stepId": "mod-swooper-maps.standard.morphology-erosion.geomorphology",
        "stepIndex": 13,
        "dataTypeKey": "morphology.topography.landMask",
        "pctLand": 0.3570611778158948,
        "landComponents": 4,
        "largestLandFrac": 0.5796637309847879
      }
    ]
  }
}
```

### Spot-check layers
```bash
bun run --cwd mods/mod-swooper-maps diag:list -- <outputDir> --dataTypeKey foundation.crustTiles.type
```
```json
{
  "layers": [
    {
      "dataTypeKey": "foundation.crustTiles.type",
      "stats": { "min": 0, "max": 1 }
    }
  ]
}
```

```bash
bun run --cwd mods/mod-swooper-maps diag:list -- <outputDir> --dataTypeKey morphology.topography.landMask
```
```json
{
  "layers": [
    {
      "dataTypeKey": "morphology.topography.landMask",
      "stepId": "mod-swooper-maps.standard.morphology-coasts.landmass-plates",
      "stats": { "min": 0, "max": 1 }
    },
    {
      "dataTypeKey": "morphology.topography.landMask",
      "stepId": "mod-swooper-maps.standard.morphology-erosion.geomorphology",
      "stats": { "min": 0, "max": 1 }
    }
  ]
}
```

