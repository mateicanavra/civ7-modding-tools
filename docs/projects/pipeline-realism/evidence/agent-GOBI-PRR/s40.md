# s40 â€” Phase D observability enforcement (1080/1092)

This slice hardens observability surfaces as enforcement by making gates reflect runtime truth (no capped-metric artifacts; config evaluated from compiled recipe inputs).

## Targets
- #1080 (`PRRT_kwDOOOKvrc5swnAd`): `plateFitP90` reflects an uncapped residual distribution (normalization scale is not a cap).
- #1092 (`PRRT_kwDOOOKvrc5swmzA`): morphology driver correlation invariant uses recipe-compiled (runtime) mountain config instead of static op defaults.

PR:
- https://app.graphite.com/github/pr/mateicanavra/civ7-modding-tools/1156

## Gates / Tests
```bash
bun run --cwd mods/mod-swooper-maps check
bun run --cwd mods/mod-swooper-maps test

# Plan thread table commands
bun run --cwd mods/mod-swooper-maps test test/foundation/m11-plate-motion.test.ts
bun run --cwd mods/mod-swooper-maps test test/pipeline/foundation-gates.test.ts
bun run --cwd mods/mod-swooper-maps test test/morphology/m11-mountains-physics-anchored.test.ts

# Cross-slice posture gates
bun run --cwd mods/mod-swooper-maps test test/pipeline/no-shadow-paths.test.ts
bun run --cwd mods/mod-swooper-maps test test/pipeline/determinism-suite.test.ts
```

## Evidence

### Dump
```bash
bun run --cwd mods/mod-swooper-maps diag:dump -- 106 66 1337 --label s40-phase-d-observability
```
```json
{"runId":"65efcd0dd9265a2c0b07561720946a8e9d1fa49e493512a9f7b82b36229036ac","outputDir":"/Users/mateicanavra/Documents/.nosync/DEV/worktrees/wt-agent-GOBI-PRR-milestone-no-legacy-foundation-morphology/mods/mod-swooper-maps/dist/visualization/s40-phase-d-observability/65efcd0dd9265a2c0b07561720946a8e9d1fa49e493512a9f7b82b36229036ac"}
```

### Analyze
```bash
bun run --cwd mods/mod-swooper-maps diag:analyze -- <outputDir>
```
```json
{
  "runA": {
    "runId": "65efcd0dd9265a2c0b07561720946a8e9d1fa49e493512a9f7b82b36229036ac",
    "dir": "/Users/mateicanavra/Documents/.nosync/DEV/worktrees/wt-agent-GOBI-PRR-milestone-no-legacy-foundation-morphology/mods/mod-swooper-maps/dist/visualization/s40-phase-d-observability/65efcd0dd9265a2c0b07561720946a8e9d1fa49e493512a9f7b82b36229036ac",
    "landmasks": [
      {
        "stepId": "mod-swooper-maps.standard.morphology-coasts.landmass-plates",
        "dataTypeKey": "morphology.topography.landMask",
        "pctLand": 0.3570611778158948,
        "landComponents": 4,
        "largestLandFrac": 0.5796637309847879
      },
      {
        "stepId": "mod-swooper-maps.standard.morphology-erosion.geomorphology",
        "dataTypeKey": "morphology.topography.landMask",
        "pctLand": 0.3570611778158948,
        "landComponents": 4,
        "largestLandFrac": 0.5796637309847879
      }
    ]
  }
}
```

### Spot-check layers
```bash
bun run --cwd mods/mod-swooper-maps diag:list -- <outputDir> --dataTypeKey foundation.crustTiles.type
```
```json
{
  "layers": [
    {
      "dataTypeKey": "foundation.crustTiles.type",
      "stats": { "min": 0, "max": 1 }
    }
  ]
}
```

```bash
bun run --cwd mods/mod-swooper-maps diag:list -- <outputDir> --dataTypeKey morphology.topography.landMask
```
```json
{
  "layers": [
    {
      "dataTypeKey": "morphology.topography.landMask",
      "stepId": "mod-swooper-maps.standard.morphology-coasts.landmass-plates",
      "stats": { "min": 0, "max": 1 }
    },
    {
      "dataTypeKey": "morphology.topography.landMask",
      "stepId": "mod-swooper-maps.standard.morphology-erosion.geomorphology",
      "stats": { "min": 0, "max": 1 }
    }
  ]
}
```

